<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculates sample size for a stratified sampling — silv_sample_size_stratified • silviculture</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Merriweather-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculates sample size for a stratified sampling — silv_sample_size_stratified"><meta name="description" content="Calculates the sample size needed for a stratified inventory, estimated from
pilot inventory data."><meta property="og:description" content="Calculates the sample size needed for a stratified inventory, estimated from
pilot inventory data."><meta property="og:image" content="https://cidree.github.io/silviculture/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">silviculture</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Cidree/silviculture" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculates sample size for a stratified sampling</h1>

      <div class="d-none name"><code>silv_sample_size_stratified.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the sample size needed for a stratified inventory, estimated from
pilot inventory data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">silv_sample_size_stratified</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">strata</span>,</span>
<span>  <span class="va">total_area</span>,</span>
<span>  <span class="va">plot_size</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"optimal"</span>,</span>
<span>  cost <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  max_error <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  currency <span class="op">=</span> <span class="st">"EUR"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a <code>data.frame</code> of pilot inventory data</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>name of the variable in <code>data</code> that was measured (e.g. basal area, volume)</p></dd>


<dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>name of the variable in <code>data</code> with the name of the stratum</p></dd>


<dt id="arg-total-area">total_area<a class="anchor" aria-label="anchor" href="#arg-total-area"></a></dt>
<dd><p>name of the variable in <code>data</code> with the area of the stratum</p></dd>


<dt id="arg-plot-size">plot_size<a class="anchor" aria-label="anchor" href="#arg-plot-size"></a></dt>
<dd><p>a numeric vector of length one with plot size in squared meters</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>a charater vector of length one with the id of the method. Available
options are <code>optimal</code>, <code>cost</code>, and <code>prop</code>. See details</p></dd>


<dt id="arg-cost">cost<a class="anchor" aria-label="anchor" href="#arg-cost"></a></dt>
<dd><p>name of the variable in <code>data</code> with the average cost of measuring one plot
of the stratum. Used with <code>method = 'cost'</code> for sample size, and for message output in
other methods</p></dd>


<dt id="arg-max-error">max_error<a class="anchor" aria-label="anchor" href="#arg-max-error"></a></dt>
<dd><p>maximum allowed relative error</p></dd>


<dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>confidence level</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>maximum number of iteration to find the plot size</p></dd>


<dt id="arg-currency">currency<a class="anchor" aria-label="anchor" href="#arg-currency"></a></dt>
<dd><p>currency to be shown in console output when using <code>method = 'cost'</code></p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>if <code>TRUE</code>, messages will be supressed</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>S7 <code>StratifiedSampleSize</code> object with:</p><ul><li><p><strong>results</strong>: <code>data.frame</code> with the main results by stratum</p></li>
<li><p><strong>strata_error</strong>: <code>data.frame</code> with maximum absolute error \(\mp\) C.I (max_abs_error,
x_min, x_max), and the esimator of the typical error \(\mp\) C.I (sampling error, x_ci_lo,
x_ci_hi)</p></li>
<li><p><strong>sampling_error</strong>: <code>data.frame</code> with the maximum absolute error \(\mp\) C.I (max_abs_error,
x_min, x_max), and the typical sampling error of the weighted mean \(\mp\) C.I (sampling error,
x_ci_lo, x_ci_hi)</p></li>
<li><p><strong>sampling_opts</strong>: <code>list</code> with function options</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Stratified Sampling calculates the number of plots to be inventored in different strata.
For instance, you might have <em>Pinus sylvestris</em> and <em>Pinus pinaster</em> plots in the same
forest, and you might want to get the optimal number of plots for field inventory of each
stratum, for a given maximum relative error (e.g. 5%), and with a certain level of confidence
(e.g 95%). Of course, the area of <em>P. sylvestris</em> will be different than the area occupied by
<em>P. pinaster</em>. For instance, the total area of <em>P. sylvestris</em> could be 100 ha, while the area
of <em>P. pinaster</em> could be 200 ha. Therefore, you need to create a pilot inventory and measure
a variable such as basal area maybe in 5 pilot plots of <em>P. sylvestris</em> and 7 pilot plots of
<em>P. pinaster</em>. With that data collected, you can use three stratified sample size methods:</p><ul><li><p><strong>Optimal Allocation with Constant Cost</strong>: using <code>method = 'optimal'</code>. The sampling units
are distributed within the different strata taking into account the size (e.g. 100 ha vs 200
ha) and the heterogeinity (e.g. differences in basal area). It minimizes the number of
sampling units.</p></li>
</ul><p>\(n = \frac{t^2_{n - m} \cdot (\sum^{j = m}_{j = 1} P_j \cdot s_j)^2 }{\epsilon^2 + \frac{t^2_{n - m} \cdot \sum^{j = m}_{j = 1} P_j \cdot s_j^2}{N}}\)</p><ul><li><p><strong>Optimal Allocation with Variable Cost</strong>: using <code>method = 'cost'</code>. This method needs to know
the cost of a sampling unit in each strata. It will minimize the cost of the inventory,
taking into account the size, the heterogeinity, and the cost of the sampling unit of the strata.</p></li>
</ul><p>\(n = \frac{t^2_{n-m} \cdot (\sum^{j = m}_{j = 1} \cdot P_j \cdot s_j \cdot \sqrt{c_j}) \cdot (\sum^{j = m}_{j = 1} \cdot \frac{P_j \cdot s_j}{\sqrt{c_j}})}{\epsilon^2 + \frac{t^2_{n - m} \cdot \sum^{j = m}_{j = 1} P_j \cdot s_j^2}{N}}\)</p><ul><li><p><strong>Proportional Allocation</strong>: using <code>method = 'prop'</code>. The sampling units are distributed
proportional to the size of the strata. In the example, 33% of the estimated sampling
units will be allocated to <em>P. sylvestris</em> and 66% to <em>P. pinaster</em>.</p></li>
</ul><p>\(n = \frac{t^2_{n - m} \cdot \sum^{j = m}_{j = 1} P_j \cdot s_j^2 }{\epsilon^2 + \frac{t^2_{n - m} \cdot \sum^{j = m}_{j = 1} P_j \cdot s_j^2}{N}}\)</p>
<p>Where:</p><ul><li><p><strong>n</strong>: estimated sample size</p></li>
<li><p><strong>t</strong>: the value of student's t</p></li>
<li><p><strong>\(P_j\)</strong>: proportion of pilot plots of \(j^{th}\) strata</p></li>
<li><p><strong>\(s_j\)</strong>: standard deviation of <code>x</code></p></li>
<li><p><strong>\(s_j^2\)</strong>: variance of <code>x</code></p></li>
<li><p><strong>N</strong>: population size (number of plots of <code>plot_size</code> that fit in <code>total_area</code>)</p></li>
<li><p><strong>\(\epsilon\)</strong>: maximum allowed absolute error. Calculated from <code>x</code> and <code>max_error</code></p></li>
<li><p><strong>N</strong>: the size of the pilot inventory</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## read pilot inventory ficticious data</span></span></span>
<span class="r-in"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/pilot_inventory.csv"</span>, package <span class="op">=</span> <span class="st">"silviculture"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">inventory_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">data_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## calculate sample size</span></span></span>
<span class="r-in"><span><span class="va">sample_size_list</span> <span class="op">&lt;-</span> <span class="fu">silv_sample_size_stratified</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data  <span class="op">=</span> <span class="va">inventory_tbl</span>,</span></span>
<span class="r-in"><span>  x     <span class="op">=</span> <span class="va">basal_area</span>,</span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="va">stratum</span>,</span></span>
<span class="r-in"><span>  total_area <span class="op">=</span> <span class="va">area</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"optimal"</span>,</span></span>
<span class="r-in"><span>  cost <span class="op">=</span> <span class="va">cost</span>,</span></span>
<span class="r-in"><span>  plot_size <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  conf_level <span class="op">=</span> <span class="fl">.95</span>,</span></span>
<span class="r-in"><span>  max_error <span class="op">=</span> <span class="fl">.05</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Pilot inventory</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> You are estimating the sample size using a Stratified Sampling using the</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #FFFF55;">Optimal Allocation with Constant Cost</span> method.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Pilot inventory: 30 plots</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Maximum allowed error: 5%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Total sampling plots: <span style="color: #BBBB00; font-weight: bold;">164</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Actual error: 4.97%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Total cost of the inventory: 5725 EUR</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Operational inventory</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Stratum - Pinus pinaster</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Pilot inventory with 11 plots, in 9 ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Minimum sampling plots: <span style="color: #BBBB00; font-weight: bold;">46</span> with a relative error of 3.74% (95% CI [62.56,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   67.42])</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Sampling effort: 5.1 plots/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Cost per hectare: 255 EUR/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Total cost: 2300 EUR</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Stratum - Pinus radiata</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Pilot inventory with 8 plots, in 12 ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Minimum sampling plots: <span style="color: #BBBB00; font-weight: bold;">71</span> with a relative error of 4.12% (95% CI [52.85,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   57.39])</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Sampling effort: 5.9 plots/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Cost per hectare: 206.5 EUR/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Total cost: 2485 EUR</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Stratum - Pinus sylvestris</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Pilot inventory with 11 plots, in 7 ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Minimum sampling plots: <span style="color: #BBBB00; font-weight: bold;">47</span> with a relative error of 5.6% (95% CI [52.85,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   59.13])</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Sampling effort: 6.7 plots/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Cost per hectare: 134 EUR/ha</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Total cost: 940 EUR</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://adrian-cidre.com/" class="external-link">Adrián Cidre González</a>, Aitor Vázquez Veloso.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

